# Сервис доставки еды

Проект представляет собой полнофункциональный сервис доставки еды с микросервисной архитектурой.

## Технологический стек

### Backend

- Python 3.12
- Django 5.1
- Django REST Framework
- Celery
- Redis
- PostgreSQL
- Nginx
- Gunicorn (для production)
- Djoser (аутентификация)
- JWT (токены)
- Swagger/ReDoc (API документация)

### Frontend

- Vue.js 3
- Vite
- Pinia (управление состоянием)
- Vue Router
- SCSS
- JWT авторизация
- WebSocket (для real-time уведомлений)

### Мониторинг и логирование

- Prometheus
- Grafana
- Node Exporter
- Nginx Exporter
- Flower (для мониторинга Celery)

## Основные функции

### Пользовательская часть

- Регистрация и авторизация пользователей с подтверждением email
- Каталог блюд с фильтрацией и поиском
- Корзина покупок
- Оформление заказов
- Отслеживание статуса заказа в реальном времени
- Личный кабинет пользователя
- Email уведомления

### Административная часть

- Управление категориями товаров
  - Отображение количества продуктов в каждой категории
  - Автоматическая генерация slug
- Управление продуктами
  - Предпросмотр изображений
  - Быстрое редактирование статуса и цены
  - Группировка полей по разделам
- Управление заказами
  - Цветовая индикация статусов
  - Детальная информация о каждом заказе
  - Статистика продаж
- Мониторинг системы
  - Метрики производительности
  - Статистика заказов
  - Мониторинг очередей Celery

## Установка и запуск

### Требования

- Docker
- Docker Compose
- Git

### Разработка

1. Клонируйте репозиторий:

```bash
git clone <repository-url>
cd <project-directory>
```

2. Создайте файл `.env` на основе `.env.example`:

```bash
cp .env.example .env
```

3. Запустите проект в режиме разработки:

```bash
docker compose -f docker-compose.dev.yml up -d
```

### Доступные сервисы

- Frontend: <http://localhost:8081>
- API: <http://localhost:8081/api/>
- Admin панель: <http://localhost:8081/admin/>
- Swagger: <http://localhost:8081/swagger/>
- ReDoc: <http://localhost:8081/redoc/>
- Flower (мониторинг Celery): <http://localhost:5555>
- Grafana: <http://localhost:3000> (admin/admin)
- Prometheus: <http://localhost:9090>

### Production

1. Настройте переменные окружения в `.env`:

```bash
cp .env.example .env
```

2. Запустите проект:

```bash
docker compose up -d
```

## Автоматическая инициализация

При первом запуске автоматически выполняются:

- Применение миграций базы данных
- Создание суперпользователя (если не существует)
- Заполнение базы данных тестовыми продуктами (если база пуста)
- Настройка Grafana дашбордов

### Учетные данные по умолчанию

#### Development

- Admin панель:
  - Логин: admin
  - Email: <admin@example.com>
  - Пароль: admin

#### Production

Учетные данные настраиваются через переменные окружения:

- DJANGO_SUPERUSER_USERNAME
- DJANGO_SUPERUSER_EMAIL
- DJANGO_SUPERUSER_PASSWORD

## Мониторинг

### Grafana

- Доступ: <http://localhost:3000>
- Логин: admin
- Пароль: admin

Предварительно настроенные дашборды:

- Nginx статистика
- Системные метрики
- Метрики Django
- Мониторинг Celery

### Prometheus

- Доступ: <http://localhost:9090>
- Собирает метрики со следующих экспортеров:
  - Node Exporter (системные метрики)
  - Nginx Exporter
  - Django metrics
  - Celery metrics (через Flower)

### Flower

- Доступ: <http://localhost:5555>
- Мониторинг задач Celery
- Статистика воркеров
- Мониторинг очередей

## Кэширование

- Используется Redis для кэширования
- Настроено кэширование для:
  - Каталога продуктов
  - Категорий
  - API эндпоинтов
- Автоматическая инвалидация кэша при изменениях

## WebSocket уведомления

- Реализованы для:
  - Обновления статуса заказа
  - Уведомлений о новых заказах
  - Системных уведомлений

## Email уведомления

Настроены следующие типы уведомлений:

- Подтверждение регистрации
- Восстановление пароля
- Подтверждение заказа
- Изменение статуса заказа
- Системные уведомления

## Логирование

- Nginx логи: `nginx/logs/`
- Django логи: через stdout контейнера
- Celery логи: через stdout контейнера и Flower

## API Документация

- Swagger UI: <http://localhost:8081/swagger/>
- ReDoc: <http://localhost:8081/redoc/>

## Тестирование

```bash
# Запуск тестов
docker compose -f docker-compose.dev.yml exec django python manage.py test

# Запуск с coverage
docker compose -f docker-compose.dev.yml exec django coverage run manage.py test
docker compose -f docker-compose.dev.yml exec django coverage report
```

## Безопасность

- JWT авторизация
- CORS настройки
- Rate limiting
- Защита от CSRF
- Безопасные заголовки HTTP
- Настроенные разрешения Django REST framework

## Разработка

### Структура проекта

```
.
├── backend/             # Django backend
│   ├── products/       # Приложение продуктов
│   ├── orders/         # Приложение заказов
│   ├── users/          # Приложение пользователей
│   └── utils/          # Общие утилиты
├── frontend/           # Vue.js frontend
├── nginx/             # Nginx конфигурация
├── prometheus/        # Prometheus конфигурация
└── grafana/          # Grafana дашборды
```

### Рекомендации по разработке

- Следуйте PEP 8 для Python кода
- Используйте типизацию Python
- Пишите тесты для новой функциональности
- Следуйте принципам REST API
- Документируйте API через Swagger/ReDoc
- Используйте линтеры и форматтеры

## Управление проектом

Для удобного управления всеми сервисами используйте скрипт `project.sh` в корне проекта. Он позволяет запускать, останавливать, перезапускать сервисы, просматривать логи, запускать тесты и выполнять другие типовые задачи через интерактивное меню.

### Основные команды меню project.sh

- **Запустить проект (dev)** — запуск всех сервисов в режиме разработки (`docker compose -f docker-compose.dev.yml up -d`).
- **Остановить проект (dev)** — остановка всех сервисов разработки.
- **Запустить проект (prod)** — запуск всех сервисов в production-режиме (`docker compose -f docker-compose.prod.yml up -d`).
- **Остановить проект (prod)** — остановка всех сервисов production.
- **Перезапустить backend** — пересборка и перезапуск только backend (Django).
- **Перезапустить frontend** — пересборка и перезапуск только frontend (Vue).
- **Логи backend** — просмотр логов Django.
- **Логи frontend** — просмотр логов frontend.
- **Запустить тесты backend** — запуск тестов Django.
- **Запустить тесты frontend** — запуск тестов frontend (если настроены).
- **Создать суперпользователя** — автоматическое создание суперпользователя Django.
- **Очистить Docker окружение** — удаление всех контейнеров, образов, томов и сетей (опасно!).
- **Очистить логи Docker** — очистка логов контейнеров Docker (Linux).

Для запуска меню используйте:

```bash
bash project.sh
```
